# Use a lightweight official Python runtime as the base image ğŸš€
FROM python:3.11-slim

# Install system dependencies required for building some packages (e.g., scipy) ğŸ› 
RUN apt-get update && apt-get install -y \
    build-essential \
    libatlas-base-dev \
 && rm -rf /var/lib/apt/lists/*

# Set the working directory inside the container to /app ğŸ“‚
WORKDIR /app

# Copy the dependency file into the container
COPY requirements.lock .

# Create a virtual environment inside the container at /venv
RUN python -m venv /venv

# Activate the virtual environment by updating PATH (all subsequent commands use it) ğŸ”„
ENV PATH="/venv/bin:$PATH"

# Upgrade pip and install dependencies from requirements.lock ğŸ”§
RUN pip install --upgrade pip && pip install -r requirements.lock

# Copy the entire application code, including your model folders (bert_resources and sequential_resources) ğŸ“
COPY . .

# Expose the port on which the Flask app runs (default is 5000) ğŸŒ
EXPOSE 5000

# Set environment variables if needed (here, TF_USE_LEGACY_KERAS is set to 0) ğŸ”€
ENV TF_USE_LEGACY_KERAS=0

# Define the command to run your Flask application âš¡
CMD ["python", "app.py"]
